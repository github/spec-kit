define("tab/tab",[],()=>(()=>{"use strict";var t,e={330:function(t,e,o){var i,n=this&&this.__createBinding||(Object.create?function(t,e,o,i){void 0===i&&(i=o);var n=Object.getOwnPropertyDescriptor(e,o);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[o]}}),Object.defineProperty(t,i,n)}:function(t,e,o,i){void 0===i&&(i=o),t[i]=e[o]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||(i=function(t){return i=Object.getOwnPropertyNames||function(t){var e=[];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[e.length]=o);return e},i(t)},function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var o=i(t),s=0;s<o.length;s++)"default"!==o[s]&&n(e,t,o[s]);return r(e,t),e});Object.defineProperty(e,"__esModule",{value:!0});const a=s(o(899)),c=o(535),l=o(883),d=o(844),u=o(661),h=o(616),m=o(677);window.toggleArtifact=t=>{const e=document.getElementById(`artifact-content-${t}`);e&&e.classList.toggle("hidden")},window.copyArtifact=t=>{var e;const o=null===(e=window.specAssistTab)||void 0===e?void 0:e.artifacts[t];o&&(navigator.clipboard.writeText(o.content),console.log("Artifact copied to clipboard"))},window.editArtifact=t=>{console.log("Edit artifact:",t)},console.log("Spec Kit Tab: Creating tab instance...");const p=new class{constructor(){this.currentWorkItem=null,this.projectId="",this.artifacts=[],this.activeRunId=null,this.orchestrator=new d.SpecKitOrchestrator,this.llmService=new u.LLMService,this.repositoryService=new h.RepositoryService,this.telemetryService=new m.TelemetryService}async initialize(){var t;try{console.log("Spec Kit Tab: Starting initialization..."),await a.init(),console.log("SDK initialized"),await a.ready(),console.log("SDK ready"),this.workItemClient=(0,c.getClient)(l.WorkItemTrackingRestClient),console.log("Work item client initialized");const e=a.getWebContext();this.projectId=(null===(t=e.project)||void 0===t?void 0:t.id)||"",console.log("Project ID:",this.projectId),this.orchestrator=new d.SpecKitOrchestrator,this.llmService=new u.LLMService,this.repositoryService=new h.RepositoryService,this.telemetryService=new m.TelemetryService,console.log("Services initialized"),await this.loadWorkItemData(),await this.loadLLMConnections(),this.setupEventHandlers(),await this.loadExistingArtifacts(),this.hideLoading(),console.log("Spec Kit Tab initialization completed successfully")}catch(t){console.error("Failed to initialize Spec Kit Tab:",t),this.showError("Initialization failed: "+t.message,t)}}async loadWorkItemData(){var t,e,o,i,n,r,s;try{const a=new URLSearchParams(window.location.search),c=a.get("workItemId")||a.get("id"),l=c?parseInt(c):0;if(!l)throw new Error("Work item ID not found");const d=await this.workItemClient.getWorkItem(l,this.projectId);this.currentWorkItem={id:d.id||0,title:(null===(t=d.fields)||void 0===t?void 0:t["System.Title"])||"",description:(null===(e=d.fields)||void 0===e?void 0:e["System.Description"])||"",acceptanceCriteria:(null===(o=d.fields)||void 0===o?void 0:o["Microsoft.VSTS.Common.AcceptanceCriteria"])||"",workItemType:(null===(i=d.fields)||void 0===i?void 0:i["System.WorkItemType"])||"Task",state:(null===(n=d.fields)||void 0===n?void 0:n["System.State"])||"New",assignedTo:(null===(s=null===(r=d.fields)||void 0===r?void 0:r["System.AssignedTo"])||void 0===s?void 0:s.displayName)||"Unassigned"},this.updateWorkItemDisplay()}catch(t){console.error("Error loading work item data:",t),this.showStatus("Error loading work item data","error")}}updateWorkItemDisplay(){if(!this.currentWorkItem)return;const t=document.getElementById("work-item-title"),e=document.getElementById("work-item-id"),o=document.getElementById("work-item-type"),i=document.getElementById("work-item-state"),n=document.getElementById("work-item-assignee");t&&(t.textContent=this.currentWorkItem.title),e&&(e.textContent=this.currentWorkItem.id.toString()),o&&(o.textContent=this.currentWorkItem.workItemType),i&&(i.textContent=this.currentWorkItem.state),n&&(n.textContent=this.currentWorkItem.assignedTo)}async loadLLMConnections(){try{const t=await this.llmService.getProjectConnections(this.projectId),e=document.getElementById("llm-connection");e&&(e.innerHTML="",0===t.length?e.innerHTML='<option value="">No LLM connections configured</option>':t.forEach(t=>{const o=document.createElement("option");o.value=t.id,o.textContent=`${t.name} (${t.model})`,t.isDefault&&(o.selected=!0),e.appendChild(o)}))}catch(t){console.error("Error loading LLM connections:",t);const e=document.getElementById("llm-connection");e&&(e.innerHTML='<option value="">Error loading connections</option>')}}setupEventHandlers(){var t,e,o,i,n,r,s,a;null===(t=document.getElementById("btn-specify"))||void 0===t||t.addEventListener("click",()=>this.runWorkflow("specify")),null===(e=document.getElementById("btn-specify-custom"))||void 0===e||e.addEventListener("click",()=>this.runCustomWorkflow("specify")),null===(o=document.getElementById("btn-plan"))||void 0===o||o.addEventListener("click",()=>this.runWorkflow("plan")),null===(i=document.getElementById("btn-plan-custom"))||void 0===i||i.addEventListener("click",()=>this.runCustomWorkflow("plan")),null===(n=document.getElementById("btn-tasks"))||void 0===n||n.addEventListener("click",()=>this.runWorkflow("tasks")),null===(r=document.getElementById("btn-tasks-custom"))||void 0===r||r.addEventListener("click",()=>this.runCustomWorkflow("tasks")),null===(s=document.getElementById("btn-publish-wiki"))||void 0===s||s.addEventListener("click",()=>this.publishToWiki()),null===(a=document.getElementById("btn-publish-repo"))||void 0===a||a.addEventListener("click",()=>this.publishToRepo())}async runWorkflow(t){var e,o,i;if(this.currentWorkItem)if(this.activeRunId)this.showStatus("A workflow is already running. Please wait for it to complete.","error");else try{this.setButtonsEnabled(!1),this.showStatus(`Starting ${t} workflow...`,"running");const n=null===(e=document.getElementById("llm-connection"))||void 0===e?void 0:e.value,r=parseFloat((null===(o=document.getElementById("temperature"))||void 0===o?void 0:o.value)||"0.7"),s=(null===(i=document.getElementById("output-location"))||void 0===i?void 0:i.value)||"both";if(!n)throw new Error("No LLM connection selected. Please configure an LLM connection first.");const a=await this.orchestrator.startWorkflow(t,this.currentWorkItem.id,this.projectId,{temperature:r,outputFormat:s,llmConnectionId:n});this.activeRunId=a,await this.pollWorkflowCompletion(a,t)}catch(t){this.showStatus(`Error: ${t}`,"error"),this.setButtonsEnabled(!0),this.activeRunId=null}else this.showStatus("No work item loaded","error")}async runCustomWorkflow(t){const e=await this.showCustomOptionsDialog(t);e&&console.log("Running custom workflow with options:",e)}async pollWorkflowCompletion(t,e){let o=0;const i=async()=>{o++;try{const n=await this.telemetryService.getRunDetails(t);if(!n)throw new Error("Run details not found");if("success"===n.status)return this.showStatus(`${e} workflow completed successfully!`,"success"),await this.loadGeneratedArtifacts(t,e),this.setButtonsEnabled(!0),void(this.activeRunId=null);if("failed"===n.status)return this.showStatus(`${e} workflow failed: ${n.errorMessage}`,"error"),this.setButtonsEnabled(!0),void(this.activeRunId=null);if("running"===n.status&&o<60)return this.showStatus(`${e} workflow running... (${5*o}s)`,"running"),void setTimeout(i,5e3);throw new Error("Workflow timed out")}catch(t){this.showStatus(`Error polling workflow status: ${t}`,"error"),this.setButtonsEnabled(!0),this.activeRunId=null}};await i()}async loadGeneratedArtifacts(t,e){try{const o=await this.telemetryService.getRunDetails(t);if(!o||!o.artifacts)return;o.artifacts.forEach(t=>{var i;const n={type:e,title:`${e.charAt(0).toUpperCase()+e.slice(1)} - ${null===(i=this.currentWorkItem)||void 0===i?void 0:i.title}`,content:`Generated content from ${t}`,timestamp:new Date,cost:o.cost};this.artifacts.push(n)}),this.updateArtifactsDisplay()}catch(t){console.error("Error loading generated artifacts:",t)}}updateArtifactsDisplay(){const t=document.getElementById("artifacts-container");t&&(0!==this.artifacts.length?t.innerHTML=this.artifacts.map((t,e)=>`\n            <div class="artifact-item">\n                <div class="artifact-header" onclick="toggleArtifact(${e})">\n                    <span>${t.title}</span>\n                    <span>\n                        ${t.cost?`$${t.cost.toFixed(3)}`:""}\n                        <span style="margin-left: 10px;">â–¼</span>\n                    </span>\n                </div>\n                <div class="artifact-content hidden" id="artifact-content-${e}">\n                    <pre>${t.content}</pre>\n                    <div style="margin-top: 10px;">\n                        <button onclick="copyArtifact(${e})" class="workflow-button">Copy</button>\n                        <button onclick="editArtifact(${e})" class="workflow-button">Edit</button>\n                    </div>\n                </div>\n            </div>\n        `).join(""):t.innerHTML="<p>No artifacts generated yet. Run a workflow to see results here.</p>")}async publishToWiki(){if(0!==this.artifacts.length)try{this.showStatus("Publishing to wiki...","running"),await this.sleep(2e3),this.showStatus("Successfully published to wiki!","success")}catch(t){this.showStatus(`Error publishing to wiki: ${t}`,"error")}else this.showStatus("No artifacts to publish","error")}async publishToRepo(){var t,e;if(0!==this.artifacts.length)try{this.showStatus("Saving to repository...","running");for(const o of this.artifacts){const i=`specs/${o.type}/${null===(t=this.currentWorkItem)||void 0===t?void 0:t.id}-${o.type}.md`;await this.repositoryService.saveArtifact(this.projectId,i,o.content,`Add ${o.type} for work item #${null===(e=this.currentWorkItem)||void 0===e?void 0:e.id}`)}this.showStatus("Successfully saved to repository!","success")}catch(t){this.showStatus(`Error saving to repository: ${t}`,"error")}else this.showStatus("No artifacts to publish","error")}async loadExistingArtifacts(){if(this.currentWorkItem)try{const t=await this.repositoryService.getArtifacts(this.projectId,"specs"),e=await this.repositoryService.getArtifacts(this.projectId,"plans"),o=await this.repositoryService.getArtifacts(this.projectId,"tasks");[...t,...e,...o].filter(t=>t.includes(this.currentWorkItem.id.toString()))}catch(t){console.error("Error loading existing artifacts:",t)}}setButtonsEnabled(t){["btn-specify","btn-specify-custom","btn-plan","btn-plan-custom","btn-tasks","btn-tasks-custom"].forEach(e=>{const o=document.getElementById(e);o&&(o.disabled=!t)})}showStatus(t,e){const o=document.getElementById("execution-status"),i=document.getElementById("status-content");if(o&&i){o.className=`execution-status ${e}`,o.classList.remove("hidden");const n="running"===e?'<span class="loading-spinner"></span>':"";i.innerHTML=`${n}${t}`}}async showCustomOptionsDialog(t){return null}sleep(t){return new Promise(e=>setTimeout(e,t))}hideLoading(){const t=document.getElementById("loading-indicator"),e=document.getElementById("main-content");t&&(t.style.display="none"),e&&(e.style.display="block")}showError(t,e){console.error("Spec Kit Tab Error:",t,e);const o=document.getElementById("loading-indicator"),i=document.getElementById("main-content"),n=document.getElementById("error-container"),r=document.getElementById("error-message"),s=document.getElementById("error-details");o&&(o.style.display="none"),i&&(i.style.display="none"),n&&(n.style.display="block"),r&&(r.textContent=t),s&&(s.textContent=e?JSON.stringify(e,null,2):"No additional details")}};window.specKitTab=p,window.specAssistTab=p,a.ready().then(()=>{console.log("Spec Kit Tab: SDK ready, initializing tab..."),p.initialize().catch(t=>{console.error("Failed to initialize Spec Kit tab:",t),window.showError&&window.showError("Failed to initialize: "+t.message,t)})}).catch(t=>{console.error("SDK ready failed:",t),window.showError&&window.showError("SDK initialization failed: "+t.message,t)}),p.initialize().catch(console.error)}},o={};function i(t){var n=o[t];if(void 0!==n)return n.exports;var r=o[t]={exports:{}};return e[t].call(r.exports,r,r.exports,i),r.exports}i.m=e,t=[],i.O=(e,o,n,r)=>{if(!o){var s=1/0;for(d=0;d<t.length;d++){for(var[o,n,r]=t[d],a=!0,c=0;c<o.length;c++)(!1&r||s>=r)&&Object.keys(i.O).every(t=>i.O[t](o[c]))?o.splice(c--,1):(a=!1,r<s&&(s=r));if(a){t.splice(d--,1);var l=n();void 0!==l&&(e=l)}}return e}r=r||0;for(var d=t.length;d>0&&t[d-1][2]>r;d--)t[d]=t[d-1];t[d]=[o,n,r]},i.d=(t,e)=>{for(var o in e)i.o(e,o)&&!i.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t={768:0};i.O.j=e=>0===t[e];var e=(e,o)=>{var n,r,[s,a,c]=o,l=0;if(s.some(e=>0!==t[e])){for(n in a)i.o(a,n)&&(i.m[n]=a[n]);if(c)var d=c(i)}for(e&&e(o);l<s.length;l++)r=s[l],i.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return i.O(d)},o=self.webpackChunkspec_kit_azure_devops_extension=self.webpackChunkspec_kit_azure_devops_extension||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))})();var n=i.O(void 0,[76,533],()=>i(330));return i.O(n)})());
//# sourceMappingURL=tab.js.map
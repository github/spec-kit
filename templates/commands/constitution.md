---
description: 从交互式或提供的原则输入创建或更新项目章程, 确保所有依赖模板保持同步.
handoffs: 
  - label: 构建规范
    agent: speckit.specify
    prompt: 基于更新的章程实现功能规范。我想要构建...
---

## User Input

```text
$ARGUMENTS
```

您**必须**在继续之前考虑用户输入（如果不为空）。

## 大纲

您正在更新项目章程 `/memory/constitution.md`。此文件是一个模板，包含方括号中的占位符令牌（例如 `[PROJECT_NAME]`、`[PRINCIPLE_1_NAME]`）。您的任务是（a）收集/导出具体值，（b）精确填充模板，（c）跨相关工件传播任何修改。

遵循以下执行流程：

1. 加载 `/memory/constitution.md` 中的现有章程模板。
   - 识别所有形式为 `[ALL_CAPS_IDENTIFIER]` 的占位符令牌。
   **重要提示**：用户可能需要的原则数量少于模板中使用的数量。如果指定了数量，请尊重该数量 - 遵循一般模板。您将相应地更新文档。

2. 收集/导出占位符的值：
   - 如果用户输入（对话）提供了值，请使用它。
   - 否则，从现有存储库上下文（README、文档、先前章程版本（如果嵌入））推断。
   - 对于治理日期：`RATIFICATION_DATE` 是原始采用日期（如果未知，请询问或标记 TODO），`LAST_AMENDED_DATE` 如果有变更，则为今天，否则保持之前的日期。
   - `CONSTITUTION_VERSION` 必须根据语义版本控制规则递增：
     - MAJOR: 重大变更，导致向后不兼容的治理/原则移除或重新定义。
     - MINOR: 添加新原则/段落或 materially expanded 指导。
     - PATCH: 澄清、措辞、拼写错误、非语义 refinement。
   - 如果版本升级类型模糊，请在最终确定之前提出推理。

3. 起草更新的章程内容：
   - 用具体文本替换每个占位符（除了项目选择不定义的有意保留的模板槽位，明确说明任何剩余的 bracketed tokens）。
   - 保留标题层级结构和注释，除非它们仍然提供澄清指导，否则可以在替换后删除。
   - 确保每个原则段落：简洁的名称行、捕获不可协商规则的段落（或项目符号列表），如果不明显则包含显式理由。
   - 确保治理段落列出了变更程序、版本控制政策和合规性审核期望。

4. 一致性传播检查列表（将 prior 检查列表转换为活动验证）：
   - 读取 `/templates/plan-template.md` 并确保任何“章程检查”或规则与更新后的原则对齐。
   - 读取 `/templates/spec-template.md` 以检查范围/需求对齐 - 如果章程添加/删除了强制段落或约束，请更新。
   - 读取 `/templates/tasks-template.md` 并确保任务分类反映新的或删除的原则驱动任务类型（例如，可观察性、版本控制、测试 discipline）。
   - 读取 `/templates/commands/*.md` 中的每个命令文件（包括此文件），以验证在需要通用指导时是否没有保留任何过时的引用（例如，CLAUDE 等特定智能体名称）。
   - 读取任何运行时指导文档（例如，`README.md`、`docs/quickstart.md` 或存在的智能体特定指导文件）。更新对已更改原则的引用。

5. 生成同步影响报告（将其作为constitution文件更新后的HTML注释添加到顶部）：
   - 版本变更：旧版 → 新版
   - 修改的原则列表（旧标题 → 新标题如果重命名）
   - 添加的段落
   - 删除的段落
   - 需要更新的模板（✅ 更新 / ⚠ 待处理）与文件路径
   - 如果有任何占位符 intentionally deferred，请关注 TODO。

6. 验证最终输出前：
   - 无未解释的括号令牌。
   - 版本行与报告匹配。
   - 日期采用 ISO 格式 YYYY-MM-DD。
   - 原则是声明式的、可测试的，且无模糊语言（“should” → 根据需要替换为 MUST/SHOULD 理由）。

7. 将完成的章程写回 `/memory/constitution.md`（覆盖）。

8. 向用户输出最终摘要，包含：
   - 新的版本号和升级理由。
   - 任何需要手动跟进的文件。
   - 建议的提交信息（例如，`docs: amend constitution to vX.Y.Z (principle additions + governance update)`）。

格式化和样式要求：

- 使用与模板中完全相同的 Markdown 标题（不要降级/提升级别）。
- 对长理由行进行换行，保持可读性（理想情况下<100个字符），但不要用尴尬的换行符强制。
- 在各段落之间保持一个空行。
- 避免尾随空格。

如果用户提供部分更新（例如，仅更新一个原则），仍需执行验证和版本决策步骤。

如果缺失关键信息（例如， ratification date 真的未知），请插入 `TODO(<FIELD_NAME>): explanation` 并将其包含在同步影响报告的延迟项目中。

**重要提示**：切勿创建新模板；始终在现有 `/memory/constitution.md` 文件上操作。
